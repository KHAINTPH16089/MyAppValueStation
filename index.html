<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            align-items: center;
            height: 100vh;
            background-color: #1c1c1e;
            margin: 0 auto;
            padding: 0;
            max-width: 600px;
        }

        .hidden {
            display: none;
        }

        #toast-container {
            font-size: 14px;
            color: #1d9b21;
        }

        .container {
            height: 100vh;
            text-align: center;
            background: #1E2833;
            padding: 0 20px 0 20px;
            /* border-radius: 10px; */
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            position: relative;
        }

        .ScanQR-header {
            text-align: center;
            padding: 0 10px 0 20px;
            /* border-radius: 10px; */
            /* box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1); */
            max-width: 400px;
            width: 100%;
            background-color: #1E2833;
            height: 50px;
        }

        .container img {
            margin-top: 20px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        /* video {
            max-height: 60vh;
            width: 100%;
            border-radius: 10px;
            border: 2px solid #626262;
            margin-top: 10px;
            margin-bottom: 10px;
        } */

        #result {
            margin-top: 20px;
            font-size: 1.2em;
            color: #4caf50;
        }

        #homePage .header {
            height: 50px;
            background-color: #22abe3;
        }

        .app-bar {
            background-color: #0c0e13;
            color: white;
            padding: 10px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            height: 55px;
        }

        #status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: red;
        }

        #thongKe {
            padding: 0;
            margin: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #Upload {
            margin: 0;
            padding: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #ScanQRNext {
            margin: 0;
            padding: 0;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            background-color: #282b32;
            border: none;
        }

        #lateTime {
            width: 200px;
            height: 35px;
            border: solid 1px #282b32;
            border-radius: 515px;
            padding-top: 5px;
            background-color: #282b32;
        }

        #boxValue {
            width: 100px;
            height: 80px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            color: white;
            border-radius: 10px;
            text-align: center;
            padding-top: 15px;
        }

        #listValue {
            --bs-gutter-x: 0;
            margin: 0 15px 0 15px;
        }

        #acQuy {
            margin: 15px;
        }

        .progress-vertical {
            width: 30px;
            height: 300px;
            display: flex;
            flex-direction: column-reverse;
            margin: 20px;
        }

        .progress-vertical .progress-bar {
            writing-mode: vertical-lr;
            transform: rotate(180deg);
            text-align: center;
        }

        .drop {
            position: relative;
            width: 120px;
            height: 180px;
            background: linear-gradient(to bottom, #67d1fb, #0077b6);
            border-radius: 50% 50% 50% 50%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin: 50px auto;
        }

        .drop .shine {
            position: absolute;
            width: 50px;
            height: 90px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 30px;
            left: 35px;
            transform: rotate(-30deg);
        }

        /* Thông tin lượng mưa bên trong giọt nước */
        #rainfall {
            margin: 0 20px 0 20px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            border-radius: 10px;
        }

        .rain-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        #Chart {
            margin: 20px 20px 0 20px;
            background-color: #242427;
            border: solid 1px #484848;
            box-shadow: 2px 2px #0c0c0c;
            border-radius: 10px;
        }

        .button-list {
            border: solid 1px rgb(0, 0, 0);
            border-radius: 100px;
            width: 80%;
            padding: 0;
            display: flex;
            justify-content: space-between;
            background-color: #313030;
            float: right;
            margin: 10px;
        }

        .btn-chart {
            width: 25%;
            height: 35px;
            border: none;
            margin: 0;
            padding: 0;
            border-radius: 50px;
            background-color: #313030 ;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-chart:hover {
            background-color: #000000;
        }

        .btn-chart.active {
            background-color: #181818 !important;
            color: #fff;
        }

        #switch-btn {
            position: absolute;
            top: 180px;
            right: 30px;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
        }

        #switch-btn i {
            font-size: 1.5em;
        }

        #switch-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .iconApp {
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
            border-radius: .25rem;
            background-color: #2E3A46;
            /* background-color: #24282c; */
            display: -ms-flexbox;
            display: flex;
            /* margin-bottom: 0.5rem; */
            min-height: 80px;
            padding: .5rem;
            position: relative;
            width: 100%;
            cursor: 'pointer';
        }

        .pickApp-title h4 {
            display: flex;
            justify-content: flex-start;
            color: #fff;
            margin-bottom: 1rem;
        }

        .icon {
            border-radius: .25rem;
            -ms-flex-align: center;
            align-items: center;
            display: -ms-flexbox;
            display: flex;
            font-size: 1.875rem;
            -ms-flex-pack: center;
            justify-content: center;
            text-align: center;
            width: 70px;
            background-color: #17a2b8 !important;
        }

        .info-box-content {
            display: -ms-flexbox;
            display: flex;
            -ms-flex-direction: column;
            flex-direction: column;
            -ms-flex-pack: center;
            justify-content: center;
            line-height: 1.8;
            -ms-flex: 1;
            flex: 1;
            padding: 0 10px;
            overflow: hidden;
            text-align: start;
        }

        .app-text {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #c2c7d0;
            padding: 0 10px;
        }

        .app-text-number {
            color: white;
            display: block;
            margin-top: .25rem;
            font-weight: 500;
            padding: 0 10px;
        }

        /* tab chức năng */
        .tab {
            cursor: pointer;
            border-bottom: 1px solid #535353;
        }

        .tab button {
            flex: 1;
            background-color: #1E2833;
            color: #c2c7d0;
            border: none;
            text-align: center;
            border-radius: 5px 5px 0 0;
            height: 40px;
            width: 49%;
        }
        .tab button:hover {
            /* border: 1px solid #626262; */
            border-bottom: none;
        }

        .tab button.active {
            background-color: #222;
            color: #fff;
            border: 1px solid #626262;
            border-bottom: none;
        }

        .tab-content {
            display: none;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1060;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.9); 
            /* background-color: white; */
            padding: 0;
            margin: 0;
        }

        /* Phần tử quét QR full màn hình */
        #qr-reader {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        
        #qr-reader video {
            width: auto !important;
            height: 100vh !important;
            width: 100vh !important;
        }

        #qr-shaded-region{
            padding-bottom: 100px;
        }

        #close-scanner {
            position: absolute;
            top: 2%;
            left: 20px;
            height: 35px;
            width: 35px;
            background-color: rgba(0, 0, 0, 0.4);
            border: none;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001; /* Đảm bảo nút ở trên cùng */
        }

        /* Nút chuyển đổi camera */
        #toggle-camera {
            position: absolute;
            top: 2%;
            left: 88%;
            height: 35px;
            width: 35px;
            background-color: rgba(0, 0, 0, 0.4);
            border: none;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            z-index: 1001; /* Đảm bảo nút ở trên cùng */
        }

        /* Nút upload hình ảnh */
        #upload-qr {
            position: absolute;
            top: 68%;
            left: 20%;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 1001; /* Đảm bảo nút ở trên cùng */
            text-align: center;
        }

        #upload-qr button {
            width: 35px;
            height: 35px;
            border: none;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            color: white;
        }

        #upload-qr p {
            color: white;
            font-size: 12px;
            margin: 5px 0;
            box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* Input file ẩn */
        #file-input {
            display: none;
        }

        /* form result scan qr */
        #result-form {
            width: 95vh;
            height: 200px;
            position: absolute;
            top: 50%;
            padding: 20px;
            z-index: 1005;
            /* left: 10%; */
        }
        #result-form #result-form-group{
            background-color: #1E2833;
            border-radius: 5px;
            width: 350px;
            padding: 20px;
        }
        .form-total{
    box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
    margin-bottom: 1rem;
}
.header-form{
    background-color: #3f6791;
    box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
    border-radius: 4px 4px 0 0;
    height: 46px;
    padding: 12px 20px;
}
.header-form h3{
    font-size: 1.1rem;
    font-weight: 400;
    color: white;
}
.content-form {
    padding: 1.5rem;
    color: white; 
    background-color: #343a40;
}
.content-form-help{
    border-radius: 0 0 4px 4px;
}
.content-form .content-detail{
    text-align: start;
    margin-bottom: 1rem;
}
.content-form .content-detail .content-label{
    font-weight: 500;
}
.content-form .content-detail .content-input{
    background-color: #343a40;
    border-color: #6c757d;
    color: #fff;
}
.content-form .content-detail .content-input::placeholder {
    color: #6c757d;
}
.footer-form{
    padding: .75rem 1.25rem;
    background-color: #282d31;
    border-top: 0 solid rgba(0, 0, 0, .125);
    border-radius: 0 0 4px 4px;
}
.footer-form button{
    color: #fff;
    background-color: #335476;
    border-color: #304e6d;
}

    .full-screen-img {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        position: fixed;
    }

    #LogoLoadScreen {
            position: absolute;
            top: 40%;
            left: 25%;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 1001; /* Đảm bảo nút ở trên cùng */
            text-align: center;
        }
        .dots-container {
            position: absolute;
            top: -2%;
            left: 40%;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .dot {
      width: 10px;
      height: 10px;
      margin: 0 5px;
      background-color: #fff;
      border-radius: 50%;
      opacity: 0;
      animation: blink 1.5s infinite ease-in-out;
    }

    /* Animation delay for each dot */
    .dot:nth-child(1) {
      animation-delay: 0s;
    }

    .dot:nth-child(2) {
      animation-delay: 0.3s;
    }

    .dot:nth-child(3) {
      animation-delay: 0.6s;
    }

    @keyframes blink {
      0%, 100% {
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
    }
    .footer-instruct {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            z-index: 1000;
            color: #fff;
            height: 120px;
        }
        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 100%;
            margin-bottom: 10px;
        }
        .step::before, .step::after {
            content: '';
            height: 2px;
            background-color: #ffffff;
            position: absolute;
            top: 50%;
            width: 45%;
        }
        .step::before {
            left: 0;
        }
        .step::after {
            right: 0;
        }
        .circle {
            background-color: #ffffff;
            color: #2a2f38;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }
        .clickScanQR {
            width: 220px;
            height: 220px;
            margin-top: 8vh;
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 1px rgba(0, 0, 0, .125), 0 1px 3px rgba(0, 0, 0, .2);
        }

        #temperature svg {

            width: 100px;
            height: 250px;

        }

        .dragger .label {
            fill: #FFFCF9;
            font-size: 1.8em;
            font-family: "din-condensed-web", sans-serif;
            text-anchor: middle;
            letter-spacing: 1.2px;
            font-size: 25px;
        }

        .tubeLabel {
            fill: #FCEFD6;
            font-size: 1.4em;
            font-family: "din-condensed-web", sans-serif;
            /* font-family: "filson-soft", sans-serif; */
            text-anchor: middle;
        }

        .dragger {
            -webkit-tap-highlight-color: transparent;
        }

        .range-container {
            position: relative;
            width: 30px;
            height: 220px;
            border-radius: 10px;
        }

        /* Solid color sections for each temperature range */
        .range-section {
            position: absolute;
            left: 0;
            width: 100%;
        }

        .section-0-5 { background-color: #006600; top: 14%; height: 14%; }  /* Blue for 0-15°C */
        .section-5-10 { background-color: #66cc00; top: 28%; height: 14%; }  /* Blue for 0-15°C */
        .section-10-20 { background-color: #b2ff66; top: 42%; height: 14%; }  /* Blue for 0-15°C */
        .section-20-50 { background-color: #0084ff; top: 56%; height: 14%; }  /* Blue for 0-15°C */
        .section-50-100 { background-color: #7fc1ff; top: 70%; height: 14%; } /* Light blue for 15-20°C */
        .section-100-150 { background-color: #bfe0ff; top: 84%; height: 14%; } /* Green for 20-27°C */
        .section-150-200 { background-color: #00ffff; top: 0; height: 14%; }   /* Red for 27-50°C */

        /* Temperature Labels */
        .label {
            position: absolute;
            left: 90%;
            padding-left: 10px;
            font-size: 12px;
            color: #fff;
        }

        .label-200 { top: -6px; }
        .label-150 { top: 10%; }
        .label-100 { top: 24%; }
        .label-50 { top: 37%; }
        .label-20 { top: 50%; }
        .label-10 { top: 65%; }
        .label-5 { top: 80%; }
        .label-below-0 { bottom: 0; }
        #qr-shaded-region {
            border-width: 35vh 10vh !important;
        }
    </style>
</head>

<body>
    <div class="app h-100">
        <div id="LoadScreen" style="background-color: #1E2833;">
            <img id="LogoLoadScreen" src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="padding-bottom: 3rem;">
            <img id="img-station" class="hidden full-screen-img" src="https://central.homeos.vn/images/MiniAppLoadingScreen.png" alt="Full Screen">
            <div id="" class=" dots-container">
                <div class="dot">.</div>
                <div class="dot">.</div>
                <div class="dot">.</div>
            </div>
        </div>
        <div id="pickApp" class="hidden h-100" >
            <div class="container" style="padding-top: 10vh;">
                <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200"
                    style="padding-bottom: 3rem;">
                    <div style="text-align: start; color: white;">
                        <h5>Thiết bị sử dụng:</h5>
                    </div>
                <div class="row">
                    <div class="col-12" style="padding: 10px;">
                        <div id="PickApp-button-mua" class="iconApp">
                            <div class="icon">
                                <div class="icon" >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
                                        style="color: #fff;" class="bi bi-cloud-sun" viewBox="0 0 16 16">
                                        <path
                                            d="M7 8a3.5 3.5 0 0 1 3.5 3.555.5.5 0 0 0 .624.492A1.503 1.503 0 0 1 13 13.5a1.5 1.5 0 0 1-1.5 1.5H3a2 2 0 1 1 .1-3.998.5.5 0 0 0 .51-.375A3.5 3.5 0 0 1 7 8m4.473 3a4.5 4.5 0 0 0-8.72-.99A3 3 0 0 0 3 16h8.5a2.5 2.5 0 0 0 0-5z" />
                                        <path
                                            d="M10.5 1.5a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0zm3.743 1.964a.5.5 0 1 0-.707-.707l-.708.707a.5.5 0 0 0 .708.708zm-7.779-.707a.5.5 0 0 0-.707.707l.707.708a.5.5 0 1 0 .708-.708zm1.734 3.374a2 2 0 1 1 3.296 2.198q.3.423.516.898a3 3 0 1 0-4.84-3.225q.529.017 1.028.129m4.484 4.074c.6.215 1.125.59 1.522 1.072a.5.5 0 0 0 .039-.742l-.707-.707a.5.5 0 0 0-.854.377M14.5 6.5a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="info-box-content">
                                <span class="app-text">Đo mưa</span>
                                <span class="app-text-number">Khí tượng thuỷ văn</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" style="padding: 10px;">
                        <div class="iconApp">
                            <div class="icon" style="background-color: #da4a58!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
                                    style="color: #fff;" class="bi bi-pc-display-horizontal" viewBox="0 0 16 16">
                                    <path
                                        d="M1.5 0A1.5 1.5 0 0 0 0 1.5v7A1.5 1.5 0 0 0 1.5 10H6v1H1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5v-1h4.5A1.5 1.5 0 0 0 16 8.5v-7A1.5 1.5 0 0 0 14.5 0zm0 1h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5M12 12.5a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0m2 0a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0M1.5 12h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1M1 14.25a.25.25 0 0 1 .25-.25h5.5a.25.25 0 1 1 0 .5h-5.5a.25.25 0 0 1-.25-.25" />
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <span class="app-text">Thiết bị</span>
                                <span class="app-text-number">IIoT</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" style="padding: 10px;">
                        <div class="iconApp">
                            <div class="icon" style="background-color: #28a745!important;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" style="color: white;" fill="currentColor" class="bi bi-lightbulb-fill" viewBox="0 0 16 16">
                                    <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m3 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1-.5-.5"/>
                                </svg>
                            </div>
                            <div class="info-box-content">
                                <span class="app-text">Đèn</span>
                                <span class="app-text-number">Chiếu sáng thông minh</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-instruct">
                    <div class="step">
                        <div class="circle">01</div>
                    </div>
                    <p>chọn thiết bị muốn xem</p>
                </div>
            </div>
        </div>
        <div id="ScanQR" class="hidden h-100">
            <div class="container" style="padding: 0;">
                <div class="ScanQR-header">
                    <div style="line-height: 50px; float: left;">
                        <button id="PickApp-button-pick"
                            style="height: 40px; border: none; background-color: #1E2833;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                style="color: #fff; margin-right: 10px;" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </button>

                        <!-- <img style="padding: 0; margin: 0;"
                            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAA21BMVEVHcEzR7/mGqsR6pcHd8PaqzuCDrcdHfKMVYJEBWYw1cZz+///39fOMsMhUhqkeZZQ4cZwoaZYNXY9+psFThaphjq+b0Onu8O9kj7E8dJ1Crd/2+vv96eGN0u81r+QznMuw3/Isa5jb7/U7r+MfqeFOueecu9AsrOJuxOtXh6pKteVvw+mBzO1ZvOd8y+xcveit4PTw8e0VpeAyruP4rJT3p5D5vKjxWSnycEv2noX7w7H1k3j5wbD0gmLxXTD0hWb3qJH0iWr2lXnyb0vwUh/yZj7zc1DyZDn0gWEEvxu3AAAASXRSTlMAHXaZJxhRw/7/3gEJP6X3y/H/XZB8LQ+b2M0FGF7x6z7nMtv/zXP6lbLWdFOpgb5RPf/pX3Uo/9ZiNYtOm/iwSXdd0P/lve/Hl/YjrQAAAZ1JREFUeAFskAMSxAAMAFPbtnn2/192rptBsDGMBEExHNaFICmaYVGCWyJeECVaphSV0og5w3VWZQ3T0ihaEYUpIylVsgUegDMNR2X10WgOdxmKtH6OJ9i0Kmt+T4MwQrpEDryYYhKth2mWF6n327nU3kY5ghC7eVWbH2zZdCN44CPjbessbzfvCK/JamKYI2TGHGx3YV6/azlBT97ref22QbtHwAqKA/9xLbJR3Xi0beUGHpjHf/4pCoMeWsfwXO36y49FnqU9fBfsL+eqRj52fMjzw+hF19sd4t0lLwLC3Id5tud5a4CPV5vEkMBADJzitrnWto2Jsf7/i2o3HJuyUm2+GvVX0/5unAcu5DPao0JtLMnMBqPmYk7qjur9q/J1PwgjxWvF+TxD/Bi1OD6ZvAtHkYT0QM6wSsJU1t4Cis5kbhCjzSEJL4jkT6aMQio9kAEiapWHutHslaeMEQ2H0iFW0quftQP7PpWOIj1HUaoRazA5xwZvy+MqwtjVrx8j8LE8KJ1VdBxg9ErjnV/fU52ciwH/V13y0ht6AueMOFH8ctIWAAAAAElFTkSuQmCC"
                            alt="">
                        <span style="color: rgba(255, 255, 255, .75);;">HOMEOS VIỆT NAM</span> -->
                    </div>
                </div>
                <div style="padding: 0 20px 0 20px;">
                    <img src="https://central.homeos.vn/images/Logo_HomeOS_White.png" alt="" width="200" style="margin-bottom: 30px; margin-top: 20px;">
                    <div style="padding: 20px 20px 0 20px;">
                        <div class="tab">
                            <button id="tab-scan-qr" class="tablinks" >Quét QR</button>
                            <button id="tab-text" class="tablinks">Nhập thủ công</button>
                        </div>
                    </div>
                    <div id="tab1" class="tab-content">
                        <button id="start" class="clickScanQR">
                            <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" fill="currentColor" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                                <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"/>
                                <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"/>
                                <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"/>
                                <path d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"/>
                                <path d="M12 9h2V8h-2z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="tab2" class="tab-content">
                        <div style="color: #fff; font-size: 1.5rem; padding: 50px 0 0 0;">Định danh thiết bị</div>
                        <div style="text-align: start; margin: 15px 0;">
                            <span style="color: #fff;">Mã trạm:</span>
                            <input id="device_name" type="text" style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;" placeholder="Nhập mã trạm...">
                        </div>
                        <button id="truycap" class="btn btn-warning"
                            style="background-color: #f39c12;border: solid 1px #f39c12; width: 100%; color: #fff; margin-top: 20px;"
                            >Truy cập trạm</button>
                    </div>
                </div>

                
                <div class="footer-instruct">
                    <div class="step">
                        <div class="circle">02</div>
                    </div>
                    <p>Nhấn nút quét hoặc nhập thông tin</p>
                </div>
            </div>
        </div>
        <div id="homePage" class="hidden">
            <div class="app-bar">
                <div id="status"></div>
                <button id="thongKe" class="btn btn-secondary">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <button id="Upload" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-camera" viewBox="0 0 16 16">
                        <path
                            d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4z" />
                        <path
                            d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0" />
                    </svg>
                </button>
                <div id="lateTime">
                    <p id="lateDateTime">29/10/2024 14:30:00</p>
                </div>
                <button id="ScanQRNext" class="btn btn-secondary" >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-qr-code-scan" viewBox="0 0 16 16">
                        <path
                            d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z" />
                        <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z" />
                        <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z" />
                        <path
                            d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z" />
                        <path d="M12 9h2V8h-2z" />
                    </svg>
                </button>
            </div>
            <div id="content">
                <div id="listValue" class="row">
                    <div class="col-4 p-2">
                        <div id="boxValue">
                            <h5 id="RT">-</h5>
                            <p>Nhiệt độ (°C)</p>
                        </div>
                    </div>
                    <div class="col-4 p-2">
                        <div id="boxValue">
                            <h5 id="RH">-</h5>
                            <p>Độ ẩm (%)</p>
                        </div>
                    </div>
                    <div class="col-4 p-2">
                        <div id="boxValue">
                            <h5 id="RP">-</h5>
                            <p>Áp suất (hPa)</p>
                        </div>
                    </div>
                </div>
                <div id="acQuy">
                    <div class="progress"
                        style="background-color: #242427; border: solid 1px #484848; height: 25px; border-radius: 15px; box-shadow: 2px 2px #0c0c0c;">
                        <div id="acQuy-bar" class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100">-</div>
                    </div>
                </div>
                <div id="rainfall" class="d-flex justify-content-between">
                    <!-- <div class="progress progress-vertical"
                        style="border: solid 1px #484848; width: 30px; border-radius: 15px; box-shadow: 2px 2px #0c0c0c;">
                        <div id="temp-bar" class="progress-bar" role="progressbar" style="height: 25%;"
                            aria-valuenow="25" aria-valuemin="-10" aria-valuemax="50">25°C</div>
                    </div> -->
                    <div id="temperature" style="pointer-events: none; margin-left: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="250 200 200 200">
                            <defs>
                                <linearGradient id="liquidGrad" x1="557" y1="150" x2="557" y2="546" gradientUnits="userSpaceOnUse">
                                    <stop offset="0" stop-color="#FF0909" />
                                    <stop offset="0.2" stop-color="#F3481A" />
                                    <stop offset="0.5" stop-color="#FABA2C" />
                                    <stop offset="1" stop-color="#00BCF2" />
                                </linearGradient>
                                <rect id="tube" x="357" y="150" width="60" height="400" rx="43" ry="43" />
                                <clipPath id="liquidMask">
                                    <use xlink:href="#tube" class="liquidMask" />
                                </clipPath>
                                <clipPath id="tubeMask">
                                    <use xlink:href="#tube" class="liquidMask" />
                                </clipPath>
                                <path id="liquid" d="M757,552v490H357V552c50,0,50,20,100,20s50-20,100-20,50,20,100,20S707,552,757,552Z" />
                                <mask id="gradMask">
                                    <use xlink:href="#liquid" class="liquid" x="0" fill="#FCEFD6" />
                                    <use xlink:href="#liquid" class="liquid" x="0" fill="#EEE" opacity="0.7" />
                                </mask>
                            </defs>
                    
                    
                            <g class="whole" transform="translate(0, -40)">
                    
                                <use xlink:href="#tube" class="tubeBg" fill="#C8D9D3" opacity="0.61" />
                    
                                <g class="dragger" transform="translate(-6, 0)">
                                    <circle cx="294" cy="540" r="36" fill="#FABA2C" />
                                    <path class="dragTip" d="M315.5,556.76,299.24,540.5l16.26-16.26,36.26,16.26Z" fill="#FABA2C" />
                                    <text class="label" x="294" y="551" style="font-weight: 700;">100</text>
                                    <!--  <path id="dragShine" d="M330,540c-26,2-18-44-72,0a36,36,0,0,1,72,0Z" fill="#E9E9E9" opacity="0.052"/>    -->
                                </g>
                    
                    
                                <g mask="url(#gradMask)">
                                    <use xlink:href="#tube" fill="url(#liquidGrad)" />
                                </g>
                                <line class="tubeShine" x1="371" y1="200" x2="371" y2="443" fill="none" stroke="#FFF" stroke-linecap="round"
                                    stroke-miterlimit="10" stroke-width="8" opacity="0.21" stroke-dasharray="153 30"
                                    stroke-dashoffset="-20" />
                                <!--        <text class="tubeLabel" x="400" y="180">100°</text>
                                  <text class="tubeLabel" x="400" y="356">50°</text>
                                  <text class="tubeLabel" x="400" y="540">0°</text> -->
                                <g class="measurements" fill="none" stroke="#FCEFD6" stroke-width="3" stroke-linecap="round" opacity="1">
                                    <line x1="358" y1="196" x2="370" y2="196" />
                                    <line x1="358" y1="234" x2="370" y2="234" />
                                    <line x1="358" y1="273" x2="370" y2="273" />
                                    <line x1="358" y1="311" x2="370" y2="311" />
                                    <line x1="358" y1="350" x2="370" y2="350" />
                                    <line x1="358" y1="388" x2="370" y2="388" />
                                    <line x1="358" y1="426" x2="370" y2="426" />
                                    <line x1="358" y1="465" x2="370" y2="465" />
                                    <line x1="358" y1="503" x2="370" y2="503" />
                                </g>
                    
                                <!--  <rect class="tubeShine" x="372" y="162" width="56" height="364.02" rx="31.5" ry="31.5" fill="none" stroke="#fff" stroke-miterlimit="10" stroke-width="8" stroke-linecap="round" stroke-dasharray="15 30" opacity="0.31"/> -->
                                <circle class="follower" cx="400" cy="540" r="0" fill="#62B6CB" fill-opacity="1" stroke="#FCEFD6"
                                    stroke-width="0" />
                    
                    
                    
                    
                            </g>
                        </svg>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" id="mySvg" width="40%" fill="currentColor"
                        viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path
                            d="M96 320c-53 0-96-43-96-96c0-42.5 27.6-78.6 65.9-91.2C64.7 126.1 64 119.1 64 112C64 50.1 114.1 0 176 0c43.1 0 80.5 24.3 99.2 60c14.7-17.1 36.5-28 60.8-28c44.2 0 80 35.8 80 80c0 5.5-.6 10.8-1.6 16c.5 0 1.1 0 1.6 0c53 0 96 43 96 96s-43 96-96 96L96 320zm-6.8 52c1.3-2.5 3.9-4 6.8-4s5.4 1.5 6.8 4l35.1 64.6c4.1 7.5 6.2 15.8 6.2 24.3l0 3c0 26.5-21.5 48-48 48s-48-21.5-48-48l0-3c0-8.5 2.1-16.9 6.2-24.3L89.2 372zm160 0c1.3-2.5 3.9-4 6.8-4s5.4 1.5 6.8 4l35.1 64.6c4.1 7.5 6.2 15.8 6.2 24.3l0 3c0 26.5-21.5 48-48 48s-48-21.5-48-48l0-3c0-8.5 2.1-16.9 6.2-24.3L249.2 372zm124.9 64.6L409.2 372c1.3-2.5 3.9-4 6.8-4s5.4 1.5 6.8 4l35.1 64.6c4.1 7.5 6.2 15.8 6.2 24.3l0 3c0 26.5-21.5 48-48 48s-48-21.5-48-48l0-3c0-8.5 2.1-16.9 6.2-24.3z" />
                        <text x="256" y="256" text-anchor="middle" font-size="80" fill="#e9ecef" style="text-shadow: 1px 1px #373535;">-</text>
                    </svg>
                    <!-- <div class="progress progress-vertical"
                        style="border: solid 1px #484848; width: 30px; border-radius: 15px; box-shadow: 2px 2px #0c0c0c;">
                        <div id="rain-bar" class="progress-bar" role="progressbar" style="height: 70%;"
                            aria-valuenow="70" aria-valuemin="-500" aria-valuemax="500">70mm</div>
                    </div> -->
                    <div style="padding: 20px; margin-right: 30px;">
                        <div class="range-container" id="range">
                            <!-- Solid color sections for each temperature range -->
                            <div class="range-section section-0-5"></div>
                            <div class="range-section section-5-10"></div>
                            <div class="range-section section-10-20"></div>
                            <div class="range-section section-20-50"></div>
                            <div class="range-section section-50-100"></div>
                            <div class="range-section section-100-150"></div>
                            <div class="range-section section-150-200"></div>
                        
                            <!-- Labels -->
                            <div class="label label-200">200mm</div>
                            <div class="label label-150">150mm</div>
                            <div class="label label-100">100mm</div>
                            <div class="label label-50">50mm</div>
                            <div class="label label-20">20mm</div>
                            <div class="label label-10">10mm</div>
                            <div class="label label-5">5mm</div>
                            <div class="label label-below-0">0mm</div>
                        </div>
                    </div>
                </div>
                <div id="Chart">
                    <div class="d-flex justify-content-between">
                        <div  class="d-none d-flex justify-content-center align-items-center" style="height: 40px; padding-top: 10px; padding-left: 10px;">
                            <div id="loading-spinner" class="d-none spinner-border text-light" role="status">
                            </div>
                        </div>
                        <div class="button-list">
                            <button id="button-list-ngay" class="btn btn-primary btn-chart active" type="button"
                                >Ngày</button>
                            <button id="button-list-tuan" class="btn btn-primary btn-chart" type="button"
                                >Tuần</button>
                            <button id="button-list-thang" class="btn btn-primary btn-chart" type="button"
                                >Tháng</button>
                            <button id="button-list-nam" class="btn btn-primary btn-chart" type="button"
                                >Năm</button>
                        </div>
                    </div>
                    <div>
                        <canvas id="lineBarChart" width="400" height="200"></canvas>
                    </div>

                </div>
                <div class="footer-instruct" style="height: 50px; background-color: #444;">
                    <p id="footer-stationName" style="font-size: 20px;"></p>
                </div>
            </div>
        </div>
        <div id="">

        </div>
    </div>
    <div id="qr-popup" class="modal">
        <div id="qr-reader"></div>
        <button id="close-scanner">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
            </svg>
        </button>
        <button id="toggle-camera">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5m14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5"/>
            </svg>
        </button>
        <!-- <button id="toggle-camera">Chuyển đổi Camera</button> -->
         
        <div id="result-form" class="d-none" style="width: 95vh; height: 200px;">
            <div id="result-form-group">
                <input id="result-form-stationID" disabled type="text" style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;" placeholder="Nhập mã trạm...">
                <input id="result-form-stationName" disabled type="text" style="width: 100%; height: 50px; color: #fff; padding-left: 20px; margin-top: 10px; background-color: #343a40; border: none; border-bottom: 1px solid #626262;" placeholder="Nhập mã trạm...">
                <div class="d-flex justify-content-between pt-2" >
                    <button id="result-scanagain" class="btn"  style="background-color: #c44133;border: solid 1px #c44133; width: 47%; color: #fff;">Quét lại</button>
                    <button id="result-truycap" disabled class="btn"  style="background-color: #f39c12;border: solid 1px #f39c12; width: 47%; color: #fff;">Truy cập</button>
                </div>
            </div>
            
        </div>
        <div id="upload-qr">
            <p>Di chuyển camera đến mã QR để quét hoặc</p>
            <div class="d-flex justify-content-center">
                <button style="margin-right: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cloud-arrow-up" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z"/>
                        <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
                    </svg>
                </button> 
                <p style="margin-top: 10px;">Tải hình ảnh lên</p>
            </div>
        </div>
        <div id="footer-instruct-scanQR" class="d-none footer-instruct">
            <div class="step">
                <div class="circle">03</div>
            </div>
            <p>Truy cập xem thông tin hoặc nhấn quét lại</p>
        </div>
        <input type="file" id="file-input" accept="image/*">
    </div>

    <div id="loading-popup" class="modal">
        <div class="modal-content" style="width: 80%; margin-top: 50px; margin-left: 10%;">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Đang tải dữ liệu...</h5>
              <button id="button-modal-close" type="button" class="btn-close d-none" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="progress">
                    <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 100%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
          </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.2/Draggable.min.js"></script>
    <script type="text/javascript" src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script>
        $( document ).ready(function() {

            const buttons = document.querySelectorAll(".btn-chart");
            console.log(buttons);
            
            buttons.forEach((button) => {
                button.addEventListener("click", function () {
                    buttons.forEach((btn) => btn.classList.remove("active"));
                    console.log(button);
                    this.classList.add("active");
                });
            });
        function openTab(evt, tabName) {
            // Ẩn tất cả nội dung tab
            var tabContent = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContent.length; i++) {
                tabContent[i].classList.remove("active");
            }

            // Xóa class 'active' trên tất cả các nút
            var tabLinks = document.getElementsByClassName("tablinks");
            for (var i = 0; i < tabLinks.length; i++) {
                tabLinks[i].classList.remove("active");
            }

            // Hiển thị tab được chọn và thêm class 'active' cho nút đã nhấn
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }


        // Mặc định mở tab đầu tiên
        
        setTimeout(() => {
            document.getElementById("LoadScreen").classList.add("hidden");
            document.getElementById("LogoLoadScreen").classList.add("hidden");
            document.getElementById("pickApp").classList.remove("hidden");
        }, 2000);

        var maTram = '';
        function changeQRcode() {
            document.getElementById("ScanQR").classList.remove("hidden");
            document.getElementById("homePage").classList.add("hidden");
            maTram = '';
        }
        function truyCap() {
            document.getElementById("footer-instruct-scanQR").classList.add("d-none");
            document.getElementById("result-form").classList.add("d-none");
            $('#qr-popup').modal('hide');
            document.getElementById("ScanQR").classList.add("hidden");
            document.getElementById("homePage").classList.remove("hidden");
            matram = localStorage.getItem("MATRAM");
            $("button-modal-loading").click();
            $("#loading-popup").modal({
                fadeDuration: 250,
                escapeClose: false,
                clickClose: false,
                showClose: false
            });
            
            getDataMonitoring();
        }
        function scanAgain() {
            document.getElementById("footer-instruct-scanQR").classList.add("d-none");
            document.getElementById("result-form").classList.add("d-none");
            document.getElementById("file-input").value = '';
            $("#start").click();
        }
        $("#PickApp-button-mua").click(function() {
            pickApp('MUA');
        });
        $("#PickApp-button-pick").click(function() {
            pickApp('PICK')
        });
        $("#tab-scan-qr").click(function(event) {
            openTab(event, 'tab1')
        });
        $("#tab-text").click(function(event) {
            openTab(event, 'tab2')
        });
        $("#truycap").click(function() {
            getInputValue()
        });
        $("#ScanQRNext").click(function() {
            changeQRcode()
        });
        $("#button-list-ngay").click(function() {
            clickGetData('NGAY')
        });
        $("#button-list-tuan").click(function() {
            clickGetData('TUAN')
        });
        $("#button-list-thang").click(function() {
            clickGetData('THANG')
        });
        $("#button-list-nam").click(function() {
            clickGetData('NAM')
        });
        $("#close-scanner").click(function() {
            test()
        });

        $("#result-scanagain").click(function() {
            scanAgain()
        });
        $("#result-truycap").click(function() {
            document.getElementById("result-truycap").disabled = true;
            truyCap()
        });
        function pickApp(type) {
            if (type == 'MUA') {
                document.getElementById("LoadScreen").classList.remove("hidden");
                document.getElementById("img-station").classList.remove("hidden");
                document.getElementById("pickApp").classList.add("hidden");
                setTimeout(() => {
                    document.getElementById("LoadScreen").classList.add("hidden");
                    document.getElementById("img-station").classList.add("hidden");
                    document.getElementById("ScanQR").classList.remove("hidden");
                    document.querySelector(".tablinks").click();
                }, 2000);
               
                // document.getElementById("pickApp").classList.add("hidden");
                // document.getElementById("ScanQR").classList.remove("hidden");
            } else if ('PICK') {
                document.getElementById("pickApp").classList.remove("hidden");
                document.getElementById("ScanQR").classList.add("hidden");
            }
        }
        async function CheckWorkStation (workstationID){
            var listDomain = ["ninhbinh.homeos.vn","namdinh.homeos.vn", "thoitiet.ifee.edu.vn"]
            var domain;
            var data;
            for (let i = 0; i < listDomain.length; i++) {
                data = await getDataStation(workstationID,listDomain[i]);
                console.log(data.length);
                
                if(data.length == 0 || data.length == undefined || data == null || data == '' || data == []){
                    console.log(data);
                    domain = ''; 
                } else {
                    console.log(data);
                    domain = listDomain[i]
                    break;
                }
            }
            console.log(domain);
            
            if(domain == ''){
                toastr.error("Mã trạm không tồn tại");
            } else {
                console.log(domain);
                localStorage.setItem("URL", "https://"+domain+"/Service/Service.svc");
                //$("#result").text("Kết quả quét: " + data[0].WORKSTATION_ID +"- Trạm:"+ data[0].WORKSTATION_NAME);
                document.getElementById("footer-stationName").textContent = data[0].WORKSTATION_NAME+"["+data[0].WORKSTATION_ID+"]";
                localStorage.setItem("MATRAM", data[0].WORKSTATION_ID);
                toastr.success("Truy cập thành công!");
                truyCap()
            }
        }

        async function getDomain (workstationID, type){
            return new Promise( async (resolve, reject)  => {
                var listDomain = ["namdinh.homeos.vn", "thoitiet.ifee.edu.vn"]
                var domain;
                var data;
                for (let i = 0; i < listDomain.length; i++) {
                    data = await getDataStation(workstationID,listDomain[i]);
                    console.log(data.length);
                    
                    if(data.length == 0 || data.length == undefined || data == null || data == '' || data == []){
                        console.log(data);
                        domain = ''; 
                    } else {
                        console.log(data);
                        domain = listDomain[i]
                        break;
                    }
                }
                if(type == "domain"){
                    resolve(domain);
                } else {
                    resolve(data);
                }
                
            });
        }

        async function getDataMonitoring() {
            createNewChart()
            const data = await getDM(
                "LOG_ZONE_MONITORING",
                "WORKSTATION_ID='" + localStorage.getItem("MATRAM") + "'",
                localStorage.getItem("URL")
            );
            // const dataChart = await getDataChart('NGAY', '', '', 'RD-RT-RH-RP', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
            const dataChart = await getDataChart('NGAY', '', '', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
            if (dataChart != []) {
                createChartData(dataChart, 'RD')
            }

            changeDataHomePage(data.D);
            setInterval(async () => {
                const data = await getDM(
                    "LOG_ZONE_MONITORING",
                    "WORKSTATION_ID='" + localStorage.getItem("MATRAM") + "'",
                    localStorage.getItem("URL")
                );
                changeDataHomePage(data.D);
            }, 10000);
        }

        function getCurrentTime(time) {
            // Tạo đối tượng Date mới để lấy thời gian hiện tại
            const now = new Date(time);
            
            const ngay = now.getDate(); // Ngày (1-31)
            const thang = now.getMonth() + 1; // Tháng (0-11) nên cần +1
            const nam = now.getFullYear(); // Năm (4 chữ số)
            // Lấy giờ, phút, giây
            const hours = now.getHours();   // Giờ (0-23)
            const minutes = now.getMinutes(); // Phút (0-59)
            const seconds = now.getSeconds(); // Giây (0-59)

            // Định dạng giờ thành dạng HH:MM:SS
            const chuoiNgay = `${ngay.toString().padStart(2, '0')}/${thang.toString().padStart(2, '0')}/${nam}`;
            const currentTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // Hiển thị giờ hiện tại
            document.getElementById("lateDateTime").textContent = chuoiNgay +" "+ currentTime;
        }

        function changeDataHomePage(data) {
            console.log(data);
            if(data != [] && data != null && data != ''){
                let checkRD = false;
                let checkRT = false;
                const now = new Date();
                const providedTime = new Date(data[0].DATE_CREATE);
                const differenceInMilliseconds = now.getTime() - providedTime.getTime();
                const checkTimeOnline = differenceInMilliseconds / (1000 * 60)
                console.log(differenceInMilliseconds / (1000 * 60));
                if(checkTimeOnline < 10){
                    document.getElementById("status").style.background = "green";
                }
                getCurrentTime(data[0].DATE_CREATE);
                for (let i = 0; i < data.length; i++) {
                    
                    if (data[i].ZONE_PROPERTY == "RT") {
                        checkRT = true;
                        document.getElementById("RT").textContent = data[i].ZONE_VALUE / 10 ;
                        setRangeValue(data[i].ZONE_VALUE / 10, "success")
                    } else if (data[i].ZONE_PROPERTY == "RH") {
                        document.getElementById("RH").textContent = data[i].ZONE_VALUE / 10 ;
                    } else if (data[i].ZONE_PROPERTY == "RA") {
                        updateProgressBar("acQuy-bar",0, 50, data[i].ZONE_VALUE / 10, "v")
                        document.getElementById("RH").textContent = data[i].ZONE_VALUE / 10 ;
                    } else if (data[i].ZONE_PROPERTY == "RP") {
                        document.getElementById("RP").textContent = data[i].ZONE_VALUE / 10 ;
                    } else if (data[i].ZONE_PROPERTY == "RD") {
                        checkRD = true;
                        const color = getColor(data[i].ZONE_VALUE / 10);
                        changeColorAndText(color, color, data[i].ZONE_VALUE / 10);
                        // updateProgressBar("rain-bar", -500, 500, (data[i].LAST_VALUE / 10), "mm");
                    }
                    if(checkRD == false){
                        const color = getColor(0);
                        changeColorAndText(color, color, 0);
                    }
                    if(checkRT == false){
                        setRangeValue(0)
                    }
                }
            } else {
                const path = document.querySelector("#mySvg path");
                path.setAttribute("fill", "#007bff");
            }
            $('#loading-popup').modal('hide');
        }

        function updateProgressBar(id, min, max, temp, Unit) {
            var minTemp = min;
            var maxTemp = max;
            var percentage = ((temp - minTemp) / (maxTemp - minTemp)) * 100;
            var progressBar = document.getElementById(id);
            if (percentage >= 0 && percentage <= 100) {
                progressBar.style.width = percentage + "%";
                progressBar.style.height = "100%";
                progressBar.setAttribute("aria-valuenow", percentage);
                progressBar.innerHTML = temp + Unit;
            } else {
                console.log("Temperature out of range");
            }
        }


        function getColor(value) {
            if (value > 400) {
                return "#a00ba0";
            } else if (value >= 300 && value <= 400) {
                return "#9f55e4";
            } else if (value >= 200 && value < 300) {
                return "#009999";
            } else if (value >= 150 && value < 200) {
                return "#00ffff";
            } else if (value >= 100 && value < 150) {
                return "#006600";
            } else if (value >= 50 && value < 100) {
                return "#66cc00";
            } else if (value >= 20 && value < 50) {
                return "#b2ff66";
            } else if (value >= 10 && value < 20) {
                return "#0084ff";
            } else if (value >= 5 && value < 10) {
                return "#7fc1ff";
            } else if (value >= 0 && value < 5) {
                return "#bfe0ff";
            } else if (value >= -5 && value < 0) {
                return "#ffffa6";
            } else if (value >= -10 && value < -5) {
                return "#ffff00";
            } else if (value >= -20 && value < -10) {
                return "#ffb266";
            } else if (value >= -50 && value < -20) {
                return "#ff8000";
            } else if (value >= -100 && value < -50) {
                return "#994c00";
            } else if (value >= -150 && value < -100) {
                return "#ff9999";
            } else if (value >= -200 && value < -150) {
                return "#ff3333";
            } else if (value < -200) {
                return "#660000";
            } else {
                return "value out of range";
            }
        }

        var user_id = "admin";
        // var session = '32085528-628c-449b-996f-a240ad606d1d';
        var session = "7b504acc-988a-437a-890f-389765305b47";

        if (maTram != "") {
            getDataMonitoring();
            document.getElementById("ScanQR").classList.add("hidden");
            document.getElementById("homePage").classList.remove("hidden");
        }
        function formatDateTime(date) {
            const now = new Date(date);

            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            const formattedDatetime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            return formattedDatetime
        }
        var checkCam = true;
        
        function getDM(table_name, c, url) {
            const d = {
                Uid: user_id,
                Sid: session,
                tablename: table_name,
                c: c,
                other: "",
                cmd: "",
            };

            //const Url = "https://DEV.HOMEOS.vn/service/service.svc/";

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: url+"/GetNewData?w="+localStorage.getItem("MATRAM"),
                    type: "GET",
                    dataType: "jsonp",
                    contentType: "application/json; charset=utf-8",
                    success: function (msg) {
                        try {
                            let state = JSON.parse(msg);
                            resolve(state); // Trả về dữ liệu khi thành công
                        } catch (error) {
                            reject(error); // Bắt lỗi nếu JSON parse thất bại
                        }
                    },
                    complete: function (data) {
                        // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                    },
                    error: function (e, t, x) {
                        HomeOS.Service.SetActionControl(true);
                        HomeOS.Service.ShowLabel("Lỗi dữ liệu");
                        reject(e); // Trả về lỗi nếu thất bại
                    },
                });
            });
        }

        async function clickGetData(type) {
            if (lineBarChart != null) {
                lineBarChart.destroy();
                document.getElementById("loading-spinner").classList.remove("d-none");
            }
            if (type == 'NGAY') {
                const dataChart = await getDataChart('NGAY', '', '', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                
                if (dataChart != []) {
                    createChartData(dataChart, 'RD')
                }
            } else if (type == 'TUAN') {
                const dataChart = await getDataChart('TUAN', '', '', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                if (dataChart != []) {
                    createChartData(dataChart, 'RD')
                }
            } else if (type == 'THANG') {
                const dataChart = await getDataChart('THANG', '', '', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                if (dataChart != []) {
                    createChartData(dataChart, 'RD')
                }
            } else if (type == 'NAM') {
                const dataChart = await getDataChart('NAM', '2024-01-01 16$50$08', '2024-12-30 16$50$08', 'RD---', localStorage.getItem("MATRAM"), localStorage.getItem("URL"));
                if (dataChart != []) {
                    createChartData(dataChart, 'RD')
                }
            }
        }

        function getDataStation(workstationID, domain) {
            
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: "https://"+domain+"/Service/Service.svc/ApiServicePublic/" + "GetDataWorkStation" + "/" + "WORKSTATION_ID='" + workstationID + "'",
                    type: "GET",
                    dataType: "jsonp",
                    contentType: "application/json; charset=utf-8",
                    success: function (msg) {
                        try {
                            let state = JSON.parse(msg);
                            resolve(state); // Trả về dữ liệu khi thành công
                        } catch (error) {
                            reject(error); // Bắt lỗi nếu JSON parse thất bại
                        }
                    },
                    complete: function (data) {
                        // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                    },
                    error: function (e, t, x) {
                        // HomeOS.Service.SetActionControl(true);
                        // HomeOS.Service.ShowLabel("Lỗi dữ liệu");
                        //reject(e); // Trả về lỗi nếu thất bại
                    },
                });
            });
            // if(domain == ''){
            //     toastr.error("mã trạm không tồn tại");
            // } else {
            //     console.log(state_station);
                
            //     localStorage.setItem("URL", "https://"+domain+"/Service/Service.svc");
            //     $("#result").text("Kết quả quét: " + workstationID +"- Trạm");
            //     toastr.success("Quét QR thành công");
            // }
            
        }

        function getDataChart(typeTime, start, end, type, zone, url) {

            const Url = "https://DEV.HOMEOS.vn/service/service.svc/";

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: url+"/ApiServicePublic/" + "GetDataFilterLogzone" + "/" + "TYPE_TIME='" + typeTime + "',START_DATE='" + start + "',END_DATE='" + end + "',TYPE_VALUE='" + type + "',ZONE_ADDRESS='" + zone + "'",
                    type: "GET",
                    dataType: "jsonp",
                    contentType: "application/json; charset=utf-8",
                    success: function (msg) {
                        try {
                            let state = JSON.parse(msg);
                            resolve(state); // Trả về dữ liệu khi thành công
                        } catch (error) {
                            reject(error); // Bắt lỗi nếu JSON parse thất bại
                        }
                    },
                    complete: function (data) {
                        // Có thể thêm xử lý khi request hoàn thành ở đây nếu cần
                    },
                    error: function (e, t, x) {
                        HomeOS.Service.SetActionControl(true);
                        HomeOS.Service.ShowLabel("Lỗi dữ liệu");
                        reject(e); // Trả về lỗi nếu thất bại
                    },
                });
            });
        }

        function changeColorAndText(fillColor, strokeColor, newText) {
            const path = document.querySelector("#mySvg path");
            const text = document.querySelector("#mySvg text");

            // Change the path colors
            path.setAttribute("fill", fillColor);
            path.setAttribute("stroke", strokeColor);

            // Update the text content
            text.textContent = newText + "mm";
        }
        var ctx = document.getElementById("lineBarChart");
        var lineBarChart;
        // Tạo biểu đồ
        ctx.getContext("2d");
        function createNewChart() {
            lineBarChart = new Chart(ctx, {
                type: "bar", // Chọn loại biểu đồ chính là bar
                data: {
                    labels: ["January", "February", "March", "April", "May", "June", "July"],
                    datasets: [
                        {
                            type: "bar", // Chọn kiểu bar cho dataset này
                            label: "Lượng bán hàng",
                            data: [30, 50, 40, 60, 70, 45, 80],
                            backgroundColor: "rgba(75, 192, 192, 0.5)",
                            borderColor: "rgba(75, 192, 192, 1)",
                            borderWidth: 1,
                        },
                        {
                            type: "line", // Chọn kiểu line cho dataset này
                            label: "Doanh thu",
                            data: [300, 400, 350, 450, 500, 400, 550],
                            backgroundColor: "rgba(255, 99, 132, 0.2)",
                            borderColor: "rgba(255, 99, 132, 1)",
                            fill: false, // Không tô nền dưới đường
                            tension: 0.3, // Tạo độ cong cho đường
                            borderWidth: 2,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true, // Đảm bảo trục Y bắt đầu từ 0
                        },
                    },
                },
            });
        }

        createChartData = function (data, type) {
            if (lineBarChart != null && type == "RD") {
                lineBarChart.destroy();
            }
            var RA = ctx.getContext('2d');
            let newDataRA = [];
            let newlabelRA = [];
            $.each(data, function (i, item) {
                if (item.AverageValue != 0) {
                    if (item.ZONE_PROPERTY == 'RD') {
                        newlabelRA.push(item.Label);
                        newDataRA.push(item.AverageValue/10)
                    }

                }
            })


            var dataSetRA = [{
                type: "bar", // Chọn kiểu bar cho dataset này
                label: "Lượng mưa",
                data: newDataRA,
                backgroundColor: "rgba(75, 192, 192, 0.5)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1,
            }]
            lineBarChart = new Chart(RA, createChart("bar", newlabelRA, newDataRA, "mm", "Lượng mưa", dataSetRA));
            document.getElementById("loading-spinner").classList.add("d-none");
        }

        createChart = function (type, Label, Data, Unit, LabelData, dataSet) {
            return {
                type: type, // Loại biểu đồ
                data: {
                    labels: Label,
                    datasets: dataSet
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true, // Không giữ tỷ lệ khung hình
                    responsive: true,
                    scales: {
                        y: {  // Sử dụng 'y' thay vì 'yAxes'
                            beginAtZero: true,
                            ticks: {
                                callback: function (value, index, values) {
                                    return value + ' ' + Unit;  // Thêm đơn vị Volts vào mỗi giá trị trục y
                                }
                            }
                        }
                    },
                    tooltips: {
                        callbacks: {
                            label: function (tooltipItem, data) {
                                let label = data.datasets[tooltipItem.datasetIndex].label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += tooltipItem.yLabel + ' ' + Unit;  // Thêm đơn vị Volts vào tooltip
                                return label;
                            }
                        }
                    }
                }
            }
        }

        //qrcode
        var html5QrCode;
        var currentCameraIndex = 0;  // Index camera hiện tại
        var devices = [];  // Danh sách các camera
        var isScannerRunning = false;  // Biến theo dõi trạng thái quét
        var currentCamera;
        // Hàm khởi tạo quét QR
        function startScan(cameraId, cam) {
                currentCamera = cam;
                html5QrCode = new Html5Qrcode("qr-reader");
                html5QrCode.start(
                    cameraId, 
                    {
                        fps: 10,    // Số khung hình trên giây
                        qrbox: { width: 250, height: 250 },  // Kích thước khung quét QR
                        aspectRatio: 1.7, // Đặt tỉ lệ khung hình
                        videoConstraints:{
                            facingMode: {exact: cam},
                        }
                    },
                    onScanSuccess,
                    onScanFailure
                ).then(() => {
                    isScannerRunning = true;  // Đánh dấu scanner đang chạy
                }).catch(err => {
                    console.error("Lỗi khi khởi động camera: ", err);
                });
            }

        // Khi nhấn nút mở popup quét QR
        $("#start").click(function() {
            $("#qr-popup").modal({
                fadeDuration: 250,
                escapeClose: false,
                clickClose: false,
                showClose: false
            });

            // Lấy danh sách camera và bắt đầu quét
            Html5Qrcode.getCameras().then(_devices => {
                devices = _devices; // Lưu lại danh sách camera
                console.log(devices);
                if (devices && devices.length) {
                    if(devices.length == 1){
                        startScan(devices[currentCameraIndex].id, "user");  // Bắt đầu quét với camera đầu tiên
                    } else {
                        startScan(devices[currentCameraIndex].id, "environment");
                    }
                } else {
                    console.error("Không tìm thấy thiết bị camera nào.");
                }
            }).catch(err => {
                console.error("Lỗi khi lấy danh sách camera: ", err);
            });
        });

        // Chuyển đổi camera
        $("#toggle-camera").click(function() {
            if(currentCameraIndex == devices.length){
                currentCamera = 0
            } else {
                currentCameraIndex = (currentCameraIndex + 1) % devices.length; // Chuyển qua camera tiếp theo
            }
            if(currentCamera == "user"){
                startScan(devices[currentCameraIndex].id, 'environment'); // Bắt đầu quét với camera mới
            } else {
                startScan(devices[currentCameraIndex].id, 'user');
            }
        });

        function test() {
            console.log(123);
            
        }
        // Khi nhấn nút đóng popup
        $("#close-scanner").click(function() {
            console.log(1);
            
            if (isScannerRunning) {
                html5QrCode.stop().then(ignore => {
                    isScannerRunning = false;  // Đánh dấu scanner đã dừng
                    $('#qr-popup').modal('hide'); // Đóng popup
                }).catch(err => {
                    console.error("Lỗi khi dừng quét QR: ", err);
                });
            } else {
                $('#qr-popup').modal('hide'); // Nếu không có quét đang chạy, chỉ đóng popup
            }
        });

        // Hàm xử lý khi quét thành công
        async function onScanSuccess(decodedText, decodedResult) {
            // Hiển thị kết quả trên trang chính
            //$("#result").text("Kết quả quét: " + decodedText);
            
            html5QrCode.stop().then(ignore => {
                isScannerRunning = false;  // Đánh dấu scanner đã dừng
                document.getElementById("result-form").classList.remove("d-none");
                document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
            }).catch(err => {
                console.error("Lỗi khi dừng camera sau khi quét thành công: ", err);
            });
            console.log(decodedText);
            let data;
            let domain;
            let workstation;
            if(decodedText.length > 6){
                var resultArray = decodedText.split("$");
                localStorage.setItem("URL", resultArray[0]);
                data = await getDM(
                    "DM_WORKSTATION",
                    "WORKSTATION_ID='" + resultArray[1] + "'", 
                    resultArray[0]
                );
                workstation = resultArray[1];
                document.getElementById("result-form").classList.remove("d-none");
                document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
            } else if(decodedText.length == 6) {
                domain = await getDomain(decodedText,'domain');
                const url = "https://"+domain+"/service/service.svc/"
                localStorage.setItem("URL", url);
                data = await getDM(
                    "DM_WORKSTATION",
                    "WORKSTATION_ID='" + decodedText + "'", 
                    url
                );
                workstation = decodedText;
                document.getElementById("result-form").classList.remove("d-none");
                document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
            } else {
                toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
            }
            console.log(data);
            
            if (data.data != []) {
                document.getElementById("result-truycap").disabled = false;
                matram = workstation;
                const value = await getDomain(workstation);
                document.getElementById("result-form-stationID").value = workstation;
                document.getElementById("result-form-stationName").value = value[0].WORKSTATION_NAME;
                document.getElementById("footer-stationName").textContent = value[0].WORKSTATION_NAME+"["+workstation+"]";
                checkCam = true;
                localStorage.setItem("MATRAM", workstation);
                toastr.success("Quét QR thành công");
            } else {
                toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
            }
        }

        // Hàm xử lý khi quét thất bại
        function onScanFailure(error) {
            // Xử lý lỗi (nếu cần)
        }

        // Khi nhấn nút upload QR từ hình ảnh
        $("#upload-qr").click(function() {
            $("#file-input").click();  // Mở hộp thoại chọn file
        });

        // Khi chọn file hình ảnh từ input
        $("#file-input").change(function(event) {
            var file = event.target.files[0];  // Đảm bảo lấy file đúng
            if (file) {
                // Dừng quét camera trước khi quét file
                if (isScannerRunning) {
                    html5QrCode.stop().then(function() {
                        isScannerRunning = false;  // Đánh dấu scanner đã dừng
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            var img = new Image();
                            img.onload = function() {
                                // Quét QR từ hình ảnh đã tải lên
                                html5QrCode.scanFile(file).then( async decodedText => {  // Sửa tại đây
                                    
                                    let data;
                                    let domain;
                                    let workstation;
                                    if(decodedText.length > 6){
                                        var resultArray = decodedText.split("$");
                                        localStorage.setItem("URL", resultArray[0]);
                                        data = await getDM(
                                            "DM_WORKSTATION",
                                            "WORKSTATION_ID='" + resultArray[1] + "'", 
                                            resultArray[0]
                                        );
                                        workstation = resultArray[1];
                                        document.getElementById("result-form").classList.remove("d-none");
                                        document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                    } else if(decodedText.length == 6) {
                                        domain = await getDomain(decodedText,'domain');
                                        const url = "https://"+domain+"/service/service.svc/"
                                        localStorage.setItem("URL", url);
                                        data = await getDM(
                                            "DM_WORKSTATION",
                                            "WORKSTATION_ID='" + decodedText + "'", 
                                            url
                                        );
                                        workstation = decodedText;
                                        document.getElementById("result-form").classList.remove("d-none");
                                        document.getElementById("footer-instruct-scanQR").classList.remove("d-none");
                                    } else {
                                        toastr.error("Vui lòng quét đúng mã QR của trạm mưa");
                                    }
                                    console.log(decodedText.length, data);
                                    
                                    
                                    if (data != []) {

                                        document.getElementById("result-truycap").disabled = false;
                                        matram = workstation
                                        const value = await getDomain(workstation);
                                        document.getElementById("result-form-stationID").value = workstation;
                                        document.getElementById("result-form-stationName").value = value[0].WORKSTATION_NAME;
                                        document.getElementById("footer-stationName").textContent = value[0].WORKSTATION_NAME+"["+workstation+"]";
                                        checkCam = true;
                                        toastr.success("Quét QR thành công");
                                        localStorage.setItem("MATRAM", workstation);
                                    }
                                }).catch(err => {
                                    //$("#result").text("Không thể quét QR từ hình ảnh.");
                                    console.error("Lỗi khi quét hình ảnh QR: ", err);
                                });
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);  // Đọc hình ảnh từ file
                    }).catch(err => {
                        console.error("Lỗi khi dừng camera: ", err);
                    });
                } else {
                    // Nếu không có scanner đang chạy, quét trực tiếp từ hình ảnh
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var img = new Image();
                        img.onload = function() {
                            html5QrCode.scanFile(file).then(decodedText => {
                                $("#result").text("Kết quả quét: " + decodedText); // Hiển thị kết quả
                            }).catch(err => {
                                $("#result").text("Không thể quét QR từ hình ảnh.");
                                console.error("Lỗi khi quét hình ảnh QR: ", err);
                            });
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);  // Đọc hình ảnh từ file
                }
            }
        });

        async function getInputValue() {
            var inputValue = document.getElementById("device_name").value;
            if(inputValue == null || inputValue==""){
                toastr.error("Vui lòng nhập mã trạm!");
            } else {
                CheckWorkStation(inputValue)
            }
        }

        function adjustFooter() {
            const footer = document.querySelector('.footer');
            const windowHeight = window.innerHeight;

            window.addEventListener('resize', () => {
                if (window.innerHeight < windowHeight) {
                    // Keyboard is visible, hide or adjust footer
                    footer.style.display = 'none'; // You can also reposition it instead of hiding
                } else {
                    // Keyboard is hidden, show footer
                    footer.style.display = 'block';
                }
            });
        }

        

        var xmlns = "http://www.w3.org/2000/svg",
            xlinkns = "http://www.w3.org/1999/xlink",
            select = function (s) {
                return document.querySelector(s);
            },
            selectAll = function (s) {
                return document.querySelectorAll(s);
            },
            liquid = selectAll('.liquid'),
            tubeShine = select('.tubeShine'),
            label = select('.label'),
            follower = select('.follower'),
            dragger = select('.dragger'),
            dragTip = select('.dragTip'),
            minDragY = -380,
            liquidId = 0,
            step = Math.abs(minDragY / 50),
            snap = Math.abs(minDragY / 10),
            followerVY = 0;

        gsap.set('svg', { visibility: 'visible' });
        gsap.set(dragTip, { transformOrigin: '20% 50%' });

        var tl = gsap.timeline();
        tl.to(liquid, { x: '-=200', ease: 'none', repeat: -1, stagger: 0.9 });

        tl.time(100);

        document.addEventListener('touchmove', function (event) {
            event.preventDefault();
        });

        Draggable.create(dragger, {
            type: 'y',
            bounds: { minY: minDragY, maxY: 0 },
            onDrag: onUpdate,
            throwProps: true,
            throwResistance: 2300,
            onThrowUpdate: onUpdate,
            overshootTolerance: 0,
            snap: function (value) {
                // Optional: snap to steps of 10
                // return Math.round(value / snap) * snap;
            }
        });

        function onUpdate() {
            // Get the current y position of the dragger using gsap.getProperty
            var draggerY = gsap.getProperty(dragger, 'y');
            liquidId = Math.abs(Math.round(draggerY / step));
            label.textContent = liquidId + '°C';;

            gsap.to(liquid, {
                y: draggerY * 1.12,
                ease: 'elastic.out(1, 0.4)',
                duration: 1.3
            });
        }

        gsap.to(follower, {
            y: '+=0',
            repeat: -1,
            duration: 1,
            modifiers: {
                y: function (y) {
                    var draggerY = gsap.getProperty(dragger, 'y');
                    followerVY += (draggerY - gsap.getProperty(follower, 'y')) * 0.23;
                    followerVY *= 0.69;
                    return gsap.getProperty(follower, 'y') + followerVY;
                }
            }
        });

        gsap.to(dragTip, {
            rotation: '+=0',
            repeat: -1,
            duration: 1,
            modifiers: {
                rotation: function (rotation) {
                    return rotation - followerVY;
                }
            }
        });

        gsap.to(label, {
            y: '+=0',
            repeat: -1,
            duration: 1,
            modifiers: {
                y: function (y) {
                    return y - followerVY * 0.5;
                }
            }
        });

        gsap.to(dragger, {
            y: minDragY / 2,
            onUpdate: onUpdate,
            ease: 'expo.inOut',
            duration: 1.4
        });
        function setRangeValue(value, type) {
            // Chuyển đổi giá trị value từ 0-100 thành vị trí y tương ứng
            var newY
            if(type == 'success'){
                newY = value * (minDragY / 50);
            } else {
                newY = 1 * (minDragY / 50);
            }
            

            // Cập nhật vị trí của dragger và các phần liên quan
            gsap.to(dragger, {
                y: newY,
                onUpdate: onUpdate, // Gọi lại onUpdate để cập nhật các phần khác
                ease: "expo.inOut",
                duration: 1.0 // Tốc độ di chuyển
            });
        }
        
        adjustFooter();
        });
    </script>
</body>

</html>